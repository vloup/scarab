<?xml version="1.0"?>

<document>

	<properties>
	    <title>Instructions for debian packages</title>
	    <author>Peter Tillemans</author>
	</properties>
	
	<body>
	<section name="Debian Package">
		<p>
		Installation instructions for the debian packages generated by the scarab:debian-package
		</p>
		<subsection name="Debian Package Overview">
			<p>
			The debian package has support for
			</p>
			<ul>
			   <li>Deploying the scarab instance war into the tomcat webapps folder</li>
			   <li>daily backups of the database and attachment folders</li>
			   <li>configurable through /etc/default/scarab-&lt;contextname&gt;</li>
			   <li>running the tomcat server using a security manager.</li>
			</ul>
		</subsection>
		<subsection name="Generating the debian package">
			<p>
			Contrary to the normal install instructions these assume that multiple scarab 
			instances will be deployed on the same server. The package name is defined to 
			be scarab-&lt;context&gt;, the version is generated from the upstream release 
			and the timestamp of the time of build.
			</p>
			<p>
			The context is defined in the build.properties file:
			</p>
			<pre>
			scarab.context=devtrack
			maven.war.final.name=${scarab.context}.war
			</pre>
			<p>
			Note : It is needed to define the maven.war.final.name to reflect the context 
			name, as tomcat will use the name of the war file as context.
			</p>
		</subsection>
		
		<subsection name="Support for different debian distributions">
			<p>
			The only relevant difference between the debian distributions is the version number of tomcat provided in the apt reporsitories. (e.g. debian sarge uses tomcat4 and ubuntu edgy has tomcat5). This is handled by this parameter
			</p>
			<pre>
			debian.tomcat.version=tomcat5
			</pre>
		</subsection>
		
		<subsection name="Enabling LDAP support">
		
			<p>
			To use LDAP under debian deployed scarab instances add the following properties 
			and adjust for the local circumstances
			</p>
			
			<pre>
			scarab.login.ldap.synchronizeOnStartUp=true
			scarab.login.ldap.providerFactory=com.sun.jndi.ldap.LdapCtxFactory 
			scarab.login.ldap.providerUrl=ldap://ldap1.tess.elex.be/
			scarab.login.ldap.ldapQuery=(objectClass=elexPerson)
			scarab.login.ldap.baseDn=dc=elex
			</pre>
			
			<p>
			Now we must tell tomcat to use the provided jaas.conf file. I would recommend to copy this file to the tomcat conf directory
			</p>
			
			<pre>
			sudo cp /var/lib/tomcat5/webapps/&lt;context&gt;/WEB-INF/conf/jaas.conf /etc/tomcat5/
			sudo vi /etc/default/tomcat5
			</pre>
			
			<p>
			Then uncomment the CATALINA_OPTS variable and add the system property to point to the jaas.conf file.
			</p>
			<pre>
			    CATALINA_OPTS="-Djava.security.auth.login.config=/etc/tomcat5/conf/jaas.conf -Djava.awt.headless=true -Xmx128M -server"
			</pre>
			
		</subsection>
	</section>
	</body>
</document>
