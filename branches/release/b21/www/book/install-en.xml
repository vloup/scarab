<!-- $Id$ -->
<chapter>
	<title>Scarab Installation</title>
	<warning>
		<simpara>Information in this chapter dates back to milestone 17. You may find useful general information to choose, install or configure your database server but the information on building Scarab is outdated.</simpara>
		<simpara>Until this chapter is rewritten, always refer to the <computeroutput>INSTALL</computeroutput> file at the root of your Scarab installation directory.</simpara>
	</warning>
	<sect1>
		<title>General</title>
		<sect2>
			<title>How to install Scarab</title>
			<para>In the current state of development -- and maybe in the long term as well -- Scarab does not install fully assembled, as is usually the case with an installation program.</para>
			<para>Scarab is built dynamically for every particular installation, according to local parameters among which the database used to store the issues and other information that Scarab needs to work.</para>
			<para>This could make you anxious at first sight, but the process is simple and proven: you can achieve this task easily like most other people did until now.</para>
		</sect2>
		<sect2>
			<title>The steps in a normal Scarab installation</title>
			<para>A normal installation is performed in four steps :
				<itemizedlist>
					<listitem>
						<para>Preparing the installation</para>
					</listitem>
					<listitem>
						<para>Installing and configuring the database management software</para>
					</listitem>
					<listitem>
						<para>Building Scarab</para>
					</listitem>
					<listitem>
						<para>Building the Scarab database</para>
					</listitem>
				</itemizedlist>
			</para>
		</sect2>
	</sect1>
	<sect1>
		<title>Preparing the installation</title>
		<sect2>
			<title>Choosing an operating system</title>
			<para>Scarab is theoretically portable on any system that supports Java.</para>
			<para>Practically, Scarab has been used and intensively tested on three kinds of platforms:</para>
			<itemizedlist>
				<listitem>
					<para>Linux: the platform on which the most experience has been gathered (and thus the system on which you will easily get support from the user community if ever you face a problem).</para>
				</listitem>
				<listitem>
					<para>Windows</para>
				</listitem>
				<listitem>
					<para>MacOS X: in fact, Scarab has been developed in part on this platform, and the first Scarab demonstrator, the "runbox", was running on this platform.</para>
				</listitem>
			</itemizedlist>
		</sect2>
		<sect2>
			<title>Choosing a database manager</title>
			<para>Scarab needs a database management system to store the issues and other structured information (parameters, queries, reports, modules,...). Thus, you have to choose an RDBMS (for the database installation, see the next chapter).</para>
			<para>Theoretically, you could use Scarab on any RDBMS that has a JDBC driver.</para>
			<para>Practically, you are faced with some SQL compatibility issues, and moreover, you need to have correct support for this DBMS in Torque, the persistence and object-relational mapping component associated with the Turbine framework, on which Scarab is built.</para>
			<sect3>
				<title>DBMS that have been tested with Scarab (and are supported)</title>
				<sect4>
					<title>MySQL</title>
					<para>MySQL is the DBMS on which Scarab has been developed and fully tested. If you don't have any particular reason to choose a database or another to run Scarab, MySQL should be your first choice.</para>
					<para>Which version to choose? Scarab will work with any 3.x or 4.x version of MySQL. It could happen in the future that the support of version 3 could be dropped to use the transactional functionalities that are available only in version 4. So, if you don't have a particular reason to choose a particular version, you may choose long term peace of mind and use a version 4.x. from the start.</para>
					<para>MySQL is open-source software, and it is available for free on Linux, Windows and a few other platforms (commercial licences and support are available for a fee).</para>
				</sect4>
				<sect4>
					<title>PostgreSQL</title>
					<para>Scarab has been tested successfully on PostgreSQL, version 7.2.1 and the following.</para>
					<para>PostgreSQL is open-source software, and it is available for free on Linux and Windows.</para>
				</sect4>
				<sect4>
					<title>Oracle 9i</title>
					<para>The compatibility of Scarab with Oracle 9i has also been tested</para>
					<para>Because of a problem with the manner Torque manages BLOBs, using Scarab with Oracle 9i is a bit more difficult than with other DBMS (you will have to patch the code generated by Torque).</para>
				</sect4>
				<!-- Need to write a section here about DB2 -->
			</sect3>
			<sect3>
				<title>DBMS that have been tested and are not fully supported by Scarab</title>
				<sect4>
					<title>Microsoft SQL Server</title>
					<para>The Scarab configuration on Microsoft SQL Server has been carefully defined and tested.</para>
					<para>A few problems remain, related to the mapping of certain data types by Torque and to the use of the SQL CONCAT function. These problems have not been solved at the moment.</para>
					<para>People interested in the technical details on this question may refer to the appropriate documentation page on the Scarab web site.</para>
				</sect4>
				<sect4>
					<title>Hypersonic SQL</title>
					<para>Scarab has been configured and tested carefully on HyperSonic.</para>
					<para>However, the tests have shown that Scarab is not fully operational on this platform.</para>
					<para>People interested in the technical details on this question may refer to the appropriate documentation page on the Scarab web site.</para>
				</sect4>
			</sect3>
			<sect3>
				<title>DBMS that are not supported by Scarab</title>
				<sect4>
					<title>Oracle 8i</title>
					<para>Oracle 8i has been supported with some success at the beginning of the Scarab development.</para>
					<para>This support has been discontinued in 2003 due to compatibility problems in the syntax of some SQL joins. Unless someone tackles this problem, Oracle 8i will not be supported again.</para>
					<para>But Scarab is now compatible with Oracle 9i, as it has been discussed before.</para>
				</sect4>
			</sect3>
		</sect2>
		<sect2>
			<title>Choosing a servlet container</title>
			<para>Scarab runs on any Servlet 2.3-compatible servlet engine; in fact, a patch could make Scarab compatible with 2.2 servlet engines, among which WebSphere Application Server 4.0.</para>
			<para>Practically, most Scarab users use it on Tomcat; in fact, the Scarab installation process builds a "light" Tomcat server, the "sandbox", which you can use to test or run Scarab once it has been built.</para>
			<para>You may want to deploy Scarab on an existing Tomcat installation; Resin has also been successfully tested as Scarab engine.</para>
		</sect2>
		<sect2>
			<title>Gathering the other elements required for the Scarab installation</title>
			<para>To perform the Scarab installation, you will need three more things: a Java SDK, Ant and -- of course -- Scarab itself.</para>
			<sect3>
				<title>Download and install a Java SDK</title>
				<para>If you don't have a Java SDK handy (pre-installed on some systems such as MacOS X or certain Linux distributions), you need to download and install one. Be careful: you need a Java 2 SDK and not only a JRE (Java Runtime Environment) because you will need to compile Scarab.</para>
				<para>The SDK version must be at least 1.3.1.</para>
				<para>You may download a Java SDK from <ulink url="http://java.sun.com">http://java.sun.com</ulink>.</para>
				<para>Make sure the JAVA_HOME environment variable correctly points to the directory in which your SDK is installed.</para>
			</sect3>
			<sect3>
				<title>Download and install Ant</title>
				<para>To build Scarab, you will need the Ant build system.</para>
				<para>You can download Ant from <ulink url="http://ant.apache.org">http://ant.apache.org</ulink>.</para>
				<para>The Ant version should be 1.5.1 or greater.</para>
				<para>Make sure the ANT_HOME environment variable correctly points to the directory in which Ant is installed</para>
			</sect3>
			<sect3>
				<title>Downlad Scarab</title>
				<para>You need of course to download Scarab itself. You will find the latest version (1.0-b18) at the following URL: <ulink url="http://scarab.tigris.org/servlets/ProjectDocumentList">http://scarab.tigris.org/servlets/ProjectDocumentList</ulink>.</para>
			</sect3>
		</sect2>
	</sect1>
	<sect1>
		<title>Installing the database software and preparing for Scarab installation</title>
		<sect2>
			<title>MySQL</title>
			<sect3>
				<title>Installing MySQL</title>
				<para>Please refer to the MySQL installation instructions.</para>
			</sect3>
			<sect3>
				<title>Create a database user for Scarab</title>
				<para>You will not be able (or you won't like) to run Scarab with the default MySQL security scheme (root user without password on the local machine).</para>
				<para>So, you'll probably need to create a MySQL user and grant him/her the appropriate rights. Let's suppose you want to create a database user with the name 'scarab' on a local server et grant him the rights on a 'scarab' database; connect to the admin interface (the unix command is <computeroutput>mysql</computeroutput>) and execute the following statement&nbsp;:</para>
				<para>
					<computeroutput>grant all privileges on scarab.* to scarab@localhost;</computeroutput>
				</para>
				<para>
					<computeroutput>flush privileges;</computeroutput>
				</para>
				<para>If you want the 'scarab' user to authenticate with the password 'secret' when he/she/it connects to the database server, the syntax becomes&nbsp;</para>
				<para>
					<computeroutput>grant all privileges on scarab.* to scarab@localhost identified by 'secret';</computeroutput>
				</para>
				<para>
					<computeroutput>flush privileges;</computeroutput>
				</para>
			</sect3>
			<sect3>
				<title>Setting up the MySQL parameters in Scarab</title>
				<para>Use a text or program editor to open read-only (if possible) the default properties file in the build directory of your Scarab installation. Do not modify this file.</para>
				<para>Use your editor to create a build.properties file in the same directory. Any parameter you will define in this file will take precedence on the one defined in default.properties. This allows you to keep reasonable default values for most parameters while redefining those you want (or must) change.</para>
				<sect4>
					<title>Define the database type</title>
					<para>You do not need to redefine the scarab.database.type parameter, because by default (as you can see by yourself in the default.properties file):</para>
					<para>scarab.database.type=mysql</para>
				</sect4>
				<sect4>
					<title>Define the database user</title>
					<para>Even in a default MySQL installation, you will probably have to define the database user (scarab.database.username), for instance:</para>
					<para>scarab.database.username=scarab</para>
					<para>If a password is required for this database user, you will also need to define the scarab.database.password key, for instance:</para>
					<para>scarab.database.password=secret</para>
				</sect4>
				<sect4>
					<title>Define the database server</title>
					<para>By default, the database is supposed to be on the same machine as the Scarab server:</para>
					<para>scarab.database.host=127.0.0.1</para>
					<para>If the database server isn't on the same machine as the servlet engine, you need to define the scarab.database.host ky, specifying the network name of the MySQL server or its IP address.</para>
					<para>If you are faced to database access errors to a local database (access denied), you may try to replace 127.0.0.1 by localhost.</para>
				</sect4>
			</sect3>
			<sect3>
				<title>Option: downloading an optimized driver</title>
				<para>If you build a "production" Scarab installation, you may choose to use a MySQL driver that is more recent and more performant than the one supplied in the Scarab distribution (this driver may not be bundled with Scarab because its licence is GPL).</para>
				<para>Download this driver from the MySQL web site at the following URL: <ulink url="http://www.mysql.com/downloads/api-jdbc-dev.html">http://www.mysql.com/downloads/api-jdbc-dev.html</ulink> and copy the jar in the lib directory of your Scarab installation.</para>
				<para>You also need to declare its use in your build.properties file:</para>
				<para>scarab.database.jdbc.driver.jar=mysql-connector*.jar</para>
			</sect3>
		</sect2>
		<sect2>
			<title>PostgreSQL</title>
			<sect3>
				<title>Installing PostgreSQL</title>
				<para>Please refer to the PostgreSQL installation instructions.</para>
			</sect3>
			<sect3>
				<title>Setting up the PostgreSQL in Scarab</title>
				<para/>
			</sect3>
		</sect2>
		<sect2>
			<title>Oracle 9i</title>
			<sect3>
				<title>Installing Oracle 9i</title>
				<para>Please refer to the Oracle 9i installation instructions.</para>
			</sect3>
			<sect3>
				<title>Setting up the Oracle 9i parameters in Scarab</title>
				<para/>
			</sect3>
		</sect2>
	</sect1>
	<sect1>
		<title>Building Scarab</title>
		<note>
			<simpara>This section is a formatted copy of the INSTALL file at the root of the Scarab distribution.</simpara>
		</note>
		<sect2>
			<title>Step 1: Unpack the Scarab distribution</title>
			<para>
			   The Scarab release can be downloaded as either a .zip or a .tar.gz file.
               Unpack either one of these into a directory that you have write access
               to.
          </para>
		</sect2>
		<sect2>
			<title>Step 2: Migrating an old (pre b19) version of Scarab</title>
			<para>Please, read the 2.1 section of the MIGRATION file for instructions on the migration of your current settings.</para>
			<para>If you don't have an existing pre-b19 Scarab installation, or you don't want to keep your old settings and data, then you can skip this step.</para>
		</sect2>
		<sect2>
			<title>Step 3: Configure Scarab</title>
			<para>
              If you already have an old build.properties file from a previous version
              of Scarab, please copy this build.properties file to the $SCARAB_ROOT
              directory (NOT the build directory) of your new installation.
            </para>
			<para>If you don't already have an old build.properties file, create one as follows:</para>
			<orderedlist>
				<listitem>
					<simpara>Go to your $SCARAB_HOME directory</simpara>
				</listitem>
				<listitem>
					<simpara>copy (not rename!) one of the following two files to build.properties:</simpara>
					<simpara>project.properties   (full customization property set)</simpara>
					<simpara>minimal.properties   (minimal customization property set)</simpara>
					<simpara>
					  You will choose project.properties as your starting point, if you
                      are a developer who is deeply involved into the Scarab development.
                      In all other cases minimal.properties is your best choice (believe us!). 
                      So most of you will be doing this:
                    </simpara>
					<simpara><computeroutput>cd $SCARAB_HOME</computeroutput></simpara>
					<simpara><computeroutput>cp minimal.properties build.properties</computeroutput></simpara>
				</listitem>
				<listitem>
					<simpara>
					  Scroll through your build.properties and be sure to follow the notes.
                      If you really miss a property which is not yet available in your 
                      build.properties just add it to your build.properties!
                    </simpara>
				</listitem>
			</orderedlist>
		</sect2>
		<sect2>
			<title>Step 4: Build Scarab</title>
			<para>You have two choices to build Scarab:</para>
			<orderedlist>
				<listitem>
					<simpara>Maven build:</simpara>
					<orderedlist>
						<listitem>
							<simpara>Enter the $SCARAB_ROOT directory</simpara>
						</listitem>
						<listitem>
							<simpara>call maven as follows:</simpara>
							<simpara>maven war -Dmaven.test.skip</simpara>
							<note>
								<simpara>
								  <computeroutput>-Dmaven.test.skip</computeroutput> avoids running the junit tests.
                                  If you want to run also the tests, simply enter
                                  "maven war" and the tests will be performed. Prepare
                                  for a significant amount of additional processing time!
                                  Given the tests are intended to work against a database,
                                  it's possible that you see them fail in this step if your
                                  database is not already configured. Look at the
                                </simpara>
							</note>
						</listitem>
					</orderedlist>
				</listitem>
				<listitem>
					<simpara>Ant build:</simpara>
					<orderedlist>
						<listitem>
							<simpara>Enter the $SCARAB_ROOT/build directory</simpara>
						</listitem>
						<listitem>
							<simpara>call ant as follows:</simpara>
							<simpara>ant</simpara>
						</listitem>
					</orderedlist>
				</listitem>
			</orderedlist>
		</sect2>
		<sect2>
			<title>Step 5a: Create the database</title>
			<warning>
				<simpara>ONLY IF YOU'RE NOT MIGRATING AN EXISTING INSTANCE OF SCARAB !!</simpara>
				<simpara>Read the 'MIGRATION' file if you need to preserve your data !!</simpara>
			</warning>
			<simpara>Now you can create and populate the Scarab database. </simpara>
			<simpara>Just run one of the commands bellow:</simpara>
			<simpara>If you are using ant:</simpara>
			<simpara>ant create-db</simpara>
			<simpara>or</simpara>
			<simpara>ant -Dskip.seed.data=true create-db</simpara>
			<simpara>
			  The second command avoids the population of your database with the
              Scarab sample data. If you are just testing Scarab out, then we 
              recommend that you use the first option and load the sample data 
              into the database.
            </simpara>
			<simpara>If you are using maven, similar commands exist:</simpara>
			<simpara>maven scarab:create-db</simpara>
			<simpara>maven -Dskip.seed.data=true scarab:create-db</simpara>
			<sect3>
				<title>JIRA templates</title>
				<simpara>
				  By default, a module is created with issue-types that match the
                  structure of JIRA, enabling transfer of issues from JIRA to Scarab.
                  If you don't want this extra module in your issue tracker, then you
                 can pass the option "-Dskip.jira.templates.data=true" to ant or maven,
                 e.g.
                </simpara>
				<simpara><computeroutput>ant -Dskip.jira.templates.data=true create-db</computeroutput></simpara>
				<simpara>or</simpara>
				<simpara><computeroutput>maven -Dskip.jira.templates.data=true scarab:create-db</computeroutput></simpara>
				<note><simpara>This option is independent of 'skip.seed.data', so either or both may be specified.</simpara></note>
			</sect3>
		</sect2>
		<sect2>
			<title>Step 5b: Migrate your current data</title>
			<note>
				<simpara>ONLY IF YOU ARE MIGRATING AN EXISTING INSTANCE OF SCARAB !!</simpara>
			</note>
			<simpara>Go to MIGRATION file for instructions on migrating your existing data.</simpara>
		</sect2>
		<sect2>
			<title>Step 6: [OPTIONAL] Run the tests</title>
			<simpara>If you launch the tests now they will run on your recently configured database. Just do:</simpara>
			<simpara> maven test</simpara>
			<simpara>The results of the tests will be in <computeroutput>$(SCARAB_HOME)/target/test-results/</computeroutput></simpara>
			<simpara>If you'd like to make your tests with other db environment, follow these steps:</simpara>
			<orderedlist>
				<listitem>
					<simpara>maven clean (you better start from scratch if you gonna test)</simpara>
				</listitem>
				<listitem>
					<simpara>Configure your build.properties to contain at least the correct scarab.database.type value.</simpara>
				</listitem>
				<listitem>
					<simpara>maven war</simpara>
				</listitem>
				<listitem>
					<simpara>maven scarab:create-db (make sure you choose the same database than before!!)</simpara>
				</listitem>
				<listitem>
					<simpara>maven test</simpara>
				</listitem>
			</orderedlist>
		</sect2>
		<sect2>
			<title>Step 7: Start Tomcat</title>
			<simpara>On Windows, double-click on the file $SCARAB_HOME/tomcat/bin/startup.bat</simpara>
			<simpara>On Unix/Linux, run the following shell script: $SCARAB_HOME/tomcat/bin/startup.sh'</simpara>
			<simpara>The webapplication will be available as reflected by the settings of the following properties (see step 3):</simpara>
			<itemizedlist>
				<listitem>
					<simpara>scarab.http.scheme</simpara>
				</listitem>
				<listitem>
					<simpara>scarab.http.domain</simpara>
				</listitem>
				<listitem>
					<simpara>scarab.http.port</simpara>
				</listitem>
				<listitem>
					<simpara>scarab.context</simpara>
				</listitem>
			</itemizedlist>
			<simpara>In general your Scarab will be available from a browser on the URL: ${scarab.http.scheme}://${scarab.http.domain}:${scarab.htp.port}/${scarab.context}</simpara>
			<simpara>Consequently in case you did NOT change the default properties, you now will find Scarab by pointing your Browser to: http://localhost:8080/scarab</simpara>
			<simpara>
			  If your setup is ok, you will be presented with the Scarab login page after
              one initial redirect. If that happens, congratulations! You now have Scarab 
              installed and running on your system.
            </simpara>
			<simpara>
			  If any of the above steps fail, then please read the full README.txt file.
              If you are still having problems then please subscribe to the Scarab users
              mailing list at: users-subscribe@scarab.tigris.org</simpara>
			<simpara>Once you are subscribed, send a message to users@scarab.tigris.org detailing your problem.</simpara>
		</sect2>
	</sect1>
</chapter>
