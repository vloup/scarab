#**
@author <a href="mailto:dr@bitonic.com">Douglas B. Robertson</a>
@version $Id$
*#

#set ($state = $data.Parameters.getString("state",""))
#set ($username = $data.Parameters.getString("username"))

<div id="edituser" class="app">

<h3>$l10n.EditUser</h3>

<form name="EditUserForm" action="$link.setPage("admin,EditUser.vm")" method="post">
  <input type="hidden" name="action" value="admin.ManageUser" />
  <input type="hidden" name="$scarabG.Constant.NEXT_TEMPLATE" value="admin,EditUser.vm" />
  <input type="hidden" name="$scarabG.Constant.CANCEL_TEMPLATE" value="admin,ManageUserSearch.vm" />
  <input type="hidden" name="state" value="execedituser" />
  <input type="hidden" name="lastAction" value="" />
  <input type="hidden" name="username" value="$username" />

#set ($lastAction = $data.Parameters.getString("lastAction"))

#set ($user = $data.User.getTemp($scarabG.Constant.SESSION_REGISTER))
#set ($deleted = false)
#if ((!$user.FirstName) && ($state == "showedituser"))
  #set ($user2 = $securityAdmin.getUserByUsername($username))
  #set ($regGroup = $intake.Register.Default)
  #set ($firstNameData = $user2.FirstName)
  #set ($lastNameData = $user2.LastName)
  #set ($emailData = $user2.Email)
  #set ($passwordData = "")
  #set ($deleted = $user2.Deleted)
#elseif ($user.FirstName)
  #set ($regGroup = $intake.Register.mapTo($user))
#else
  #set ($regGroup = $intake.Register.Default)
  #set ($firstNameData = $regGroup.FirstName)
  #set ($lastNameData = $regGroup.LastName)
  #set ($emailData = $regGroup.Email)
  #set ($passwordData = $regGroup.Password)
##set ($deleted = $regGroup.Deleted)
#end

<div class="axial">
<table cellpadding="3" cellspacing="2" border="0">
<tr>
 <th>* $l10n.FirstName</th>
 <td>
  <input name="$regGroup.FirstName.Key" value="$firstNameData" type="text" size="25" />
  #fieldErrorMsg($regGroup.FirstName "")
 </td>
</tr>
<tr>
 <th>* $l10n.LastName</th>
 <td>
  <input name="$regGroup.LastName.Key" value="$lastNameData" type="text" size="25" />
  #fieldErrorMsg($regGroup.LastName "")
 </td>
</tr>
<tr>
 <th>* $l10n.Email</th>
 <td>
  <input name="$regGroup.Email.Key" value="$emailData" type="text" size="25" />
  #fieldErrorMsg($regGroup.Email "")
 </td>
</tr>
<tr>
 <th>
 #if ($state != "showedituser")*#end
 $l10n.Password
 </th>
 <td>
  #if ($state != "showedituser")
  <input name="$regGroup.Password.Key" value="$passwordData" type="text" size="25" />
  #fieldErrorMsg($regGroup.Password "")
  #else
  <input name="editpassword" value="$passwordData" type="text" size="25" />
  #end
 </td>
</tr>
<tr>
 <th>$l10n.Deleted</th>
 <td>
    #if ($deleted)
      #set ($checked = "checked")
    #else
      #set ($checked = "")
    #end
   <input name="$regGroup.Deleted.Key" type="checkbox" $checked />
 </td>
</tr>
 
</table>
</div>

<p>* $l10n.Required</p>

#set ($user = $securityAdmin.getUserByUsername($username))
#set ($acl = $securityAdmin.getACL($user))

<div id="adduser" class="app">

<h3>$l10n.UserRoles</h3>

<p>$l10n.ModifyingRolesFor <b><a href="mailto:$user.Email">$!user.Name</a></b>
</p>

<table>
<tr>
<td bgcolor="#000000">

<table cellspacing="1" cellpadding="2">
  <tr>
    <td bgcolor="#ffffff">
        &#160;
    </td>
      
    #foreach ($role in $securityAdmin.Roles)
    <td bgcolor="#ffffff">
        <b>$role.Name</b>
    </td>
    #end
  
  </tr>

  #foreach ($group in $securityAdmin.Groups)
  #indexedRows ($velocityCount)
    <td bgcolor="#ffffff">
        <b>$group.Name</b>
    </td>

    #foreach ($role in $securityAdmin.Roles)
      #if ($acl.hasRole($role, $group))
        #set ($checked = "checked")
      #else
        #set ($checked = "")
      #end
    
    <td>
      <center>
      <input type="checkbox" name="${group.Name}${role.Name}" $checked />
      </center>
    </td>
    #end    
  </tr>
  #end
    
</table>
</tr>
</table>

###
<div class="functnbar3">
  <input type="submit" name="eventSubmit_doSave" value="$l10n.Save" />&#160;
  <input type="submit" name="eventSubmit_doCancel" value="$l10n.Cancel" />
</div>

<div class="functnbar2">
  <input type="submit" name="eventSubmit_doDone" value="$l10n.Done" />
</div>

$intake.declareGroups()

</form>
</div>
