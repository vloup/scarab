<?xml version="1.0"?>

<document>

<properties>
    <title>Scarab Behind a Firewall</title>
    <author email="epugh@upstate.com">Eric Pugh</author>
    <author email="dabbous@saxess.de">Hussayn Dabbous</author>    
</properties>

<body>

<section name="The problem">
<ul>
	<li>You want to setup Scarab in your company.</li>
	<li>You want Scarab to be accessible from the internet
	   throug your company firewall.</li>
	<li>The only open port to the internet is port 80,
	   and this port occuppied by your company webserver</li>   
</ul>
</section>

<section name="The solution (for unix/linux based servers)">
	<p>
		Add a "webspace" to your company webserver.
	     for apache the simplest way is as follows:
	
	     Add following two lines to your server conf,
	     e.g. within your virtual host config:
		<source>
		     ProxyPass        /scarab http://ScarabHost:8080/scarab
		     ProxyPassReverse /scarab http://ScarabHost:8080/scarab
		</source>
	     You need to adjust the host:port settings to your environment.
	     I also assume, you have mod_proxy added in your apache
	     configuration.
	     You can attach Scarab in multiple ways to your webserver,
	     but this is by far the easiest approach...
	</p>
	<p>
		Setup your "build.properties" for Scarab as follows:
	
	     The following build properties are essential. You might
	     want to change others too. Please follow the instructions
	     in the scarab-installation manual and adjust the values below
	     according to your environment:
		<source>
		     scarab.context=scarab
		     scarab.http.domain=www.yourCompany.com
		     scarab.http.port=80
		     scarab.email.domain=yourCompany.com
		     scarab.tomcat.port=8080
		     scarab.tomcat.proxy.name="www.yourCompany.com"
		     scarab.tomcat.proxy.port="80"
		</source>
	     Note: The trick is to set scarab.http.port to 80, NOT to 8080
	     The other trick is to surround the proxy settings with double quotes
	</p>
	<p>
		Build Scarab as described in the installation manual.
	</p>
	<p>
		Go to target/conf/server.xml and check that you have the following lines:
	<source>
	<![CDATA[
	     <Connector className="org.apache.coyote.tomcat4.CoyoteConnector"
	                port="9023" minProcessors="5" maxProcessors="75"
	                enableLookups="true" redirectPort="8443"
	                acceptCount="10" debug="0" connectionTimeout="60000"
	                proxyName="www.yourCompany.com"
	                proxyPort="80" />
	]]>
					</source>
	
	     Sometimes the Scarab build drops these (erroneous) lines instead:
	    			<source>
	<![CDATA[
	     <Connector className="org.apache.coyote.tomcat4.CoyoteConnector"
	                port="9023" minProcessors="5" maxProcessors="75"
	                enableLookups="true" redirectPort="8443"
	                acceptCount="10" debug="0" connectionTimeout="60000"
	                "www.yourCompany.com"
	                "80" />
	]]>
					</source>
	     Note: proxyPort and proxyName are missing. Correct this manually if
	     necessary.
	</p>
	<p>
		Build the database as described in the installation manual.
		If you already have a database, skip this point.
	</p>
	<p>
		(Re-)Start Scarab and your webserver.
	</p>
	<p>
		Now you can access Scarab from
		<source>http://www.yourCompany.com/scarab/issues</source>
		from within your intranet AND from the internet.
	</p>
</section>

</body>
</document>
