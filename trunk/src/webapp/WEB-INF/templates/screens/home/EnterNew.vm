<div id="home-enternew" class="app">

#set ($currentModule = $scarabR.CurrentModule)
#set ($currentModuleIssueTypes = $currentModule.IssueTypes)

#if ($currentModuleIssueTypes.isEmpty())
<p><em>$l10n.NoIssueTypesInModule</em></p>
#else
<h3>$l10n.IssueTypesInProject</h3>
<div class="colbar">
  $l10n.EnterNewBriefInstructions
</div>

  <table width="100%" border="1" cellspacing="2" cellpadding="3">
    <tr>
      <th>$l10n.Name</th>
    ## commenting out until functionality is added
    ##  <th>$l10n.ShowInLeftNav</th>

      <th>$l10n.Description</th>
      <th>$l10n.Templates</th>
    </tr>

#foreach ($issueType in $currentModuleIssueTypes)

    #indexedRows($velocityCount)
    #set ($rmit = $currentModule.getRModuleIssueType($issueType))
    #set ($template = $scarabR.getNextEntryTemplate($issueType))
    <td>
      #if ($issueType.canCreateIssueInScope($user, $module))
        <a href="$link.setPage($template).addPathInfo($scarabG.Constant.CURRENT_ISSUE_TYPE, $issueType.QueryKey).addPathInfo("eventSubmit_doStart", "foo").setAction("ReportIssue")">$rmit.DisplayName</a>
      #else
        $rmit.DisplayName<img src="$staticLink.setPath("/images/icon_annotation.gif")" alt="Scarab" border="0"
                              onClick="showDelayedTooltip('$rmit.DisplayName',0)"
                              style="cursor:pointer"/>


        <div style="width:500px;" class="scarab-tooltip" id="$rmit.DisplayName" onclick="hideTooltip()">
          <p>
            You have not the permission to create "$rmit.DisplayName" - Issues.
            The following table shows you the list required attributes for which
            you do not have access permission:
          </p>
          <table>
            #set ($attributeList = $issueType.getRequiredAttributes($module))
            <tr>
              <th>required attribute</th>
              <th>access</th>
            </tr>
            #foreach ($attribute in $attributeList)
              #set ($allowed = $issueType.canCreateAttributeInScope($user, $module, $attribute) )
              #if (!$allowed )
                #set ($checkmark = "/images/icon_stop.gif" )
                <tr>
                 <td><a href="$staticLink.setPath("/issues/template/admin%2CGlobalAttributeEdit.vm/att_0id/$attribute.attributeId")">$attribute.name</a></td>
                 <td><img src="$staticLink.setPath($checkmark)" alt="$allowed" border="0"</td>
                </tr>
              #end
            #end
          </table>
          <p>
            If you think, this is an error, please contact your Scarab Administrator.
            Probably your admin has defined some transition rules, which prevent
            you from creating the listed attributes. This typically happens, 
            when the current module does not use all defined option values 
            of an attribute and all transitions you are allowed to set are 
            associated to these non used option values.
          </p>
          <p>
            Please check carefully your transition matrix 
            by following the link presented in the table above
            and scroll to the bottom of the target page.
          </p>
          
        </div>

      #end
    </td>
<!-- commenting out until functionality is added
      <td><input type="checkbox" /></td>
-->
    <td>$rmit.DisplayDescription</td>

  ## TEMPLATE DROPDOWN
      <td>
  #set ($allTemplates = $scarabR.getAllIssueTemplates($issueType))
  #if ($allTemplates.isEmpty())
      $l10n.None
  #else
    <form action="$link.setPage("EnterNew.vm")" method="post">
    <input type="hidden" name="action" value="TemplateList" />
    <input type="hidden" name="eventSubmit_doUsetemplate" value="foo" />
    ##<input type="hidden" name="$scarabG.Constant.CURRENT_ISSUE_TYPE" 
    ##    value="$issueType.QueryKey" />
    <select name="templateId" onchange="this.form.submit();">
         <option value="">$l10n.SelectTemplate</option>
     #foreach ($template in $allTemplates)
         <option value="$template.Issue.IssueId">$template.Name</option>
     #end
    </select>
    <noscript><input type="submit" value="$l10n.Go" name="eventSubmit_doUsetemplate" tabindex="6" /></noscript>
    </form>
  #end
      </td>
    </tr>        
#end   
             
  </table>
#end
<!-- commenting out until functionality is added
  <div class="functnbar2">
     <input type="submit" value="$l10n.Save" name="#" />
  </div>
-->

</div>
